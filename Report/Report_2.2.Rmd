---
title: "Dependency of drug response on gene expression patterns or knockdown scores "
author: "Rositsa Todorovska"
date: "7/14/2021"
output: pdf_document
---

```{r setup, include=FALSE,global_options, R.options=knitr::opts_chunk$set(warning=FALSE, message=FALSE)}
knitr::opts_chunk$set(echo = TRUE)

library(knitr)
library(xtable)
library(dplyr)
library(readxl)
library(kableExtra)

```

```{r, include = FALSE}

#load("../Original_Environment/Original.RData")
load("../Original_Environment/prism_datasets.rda")
load("../Original_Environment/cellline_datasets.rda")

```

## PROCESS AND RESULTS

In this step, we proved through an unpaired two-sided Welch t-test, that there is no dependence of the effect of the drug response on specific gene expression rates, gene knockdowns or copy number of variations.
We performed multiple t-tests on prism.treat and genes from clusters 1 and 3, 1 and 4, as well as 3 and 4.We could not perform any tests on cluster 2 due to the only one cell line it consisted of which would provide an unrepresentative result. We also performed t-tests on the pairs of clusters from prism.exp, prism.cnv and prism.achilles. Only the results from the t-tests on prism.treat for the clusters 1-3 and 1-4 gave important information.They demonstrate that there are not any significsnt differences in the drug response between the clusters. However, there were not any major differences in knockdown scores and gene expression rates. Thus, this was not the reason for the different drug response.
For clusters 1-3 there are 3 significant drugs - "trichostatin-a","semaxanib","alvocidib" and for clusters 1-4 there are 2 drugs - "torin-1","AVN-944". 


```{r echo=FALSE,include = FALSE, results='asis',fig.cap="**1.a** Table of the 3 drugs with a significant different response for clusters 1 and 3 **1.b** Table of the 2 drugs with a significant different response for clusters 1 and 4 ", fig.height = 3, fig.width = 8, fig.align = 'center'}


km2_moa$cluster

achilles_vector_cluster1 = as.vector(na.omit(names(which(km2_moa$cluster == 1))))

achilles_vector_cluster2 = as.vector(na.omit(names(which(km2_moa$cluster == 2))))

achilles_vector_cluster3 = as.vector(na.omit(names(which(km2_moa$cluster == 3))))

achilles_vector_cluster4 = as.vector(na.omit(names(which(km2_moa$cluster == 4))))

ovary_achilles_cluster1 <- prism.achilles[rownames(prism.achilles) %in% achilles_vector_cluster1,]

ovary_achilles_cluster2 <- prism.achilles[rownames(prism.achilles) %in% achilles_vector_cluster2,]

ovary_achilles_cluster3 <- prism.achilles[rownames(prism.achilles) %in% achilles_vector_cluster3,]

ovary_achilles_cluster4 <- prism.achilles[rownames(prism.achilles) %in% achilles_vector_cluster4,]



mean_effective_ovary_new4= data.frame(row.names=rownames(prism))

for (drug in unique(prism.treat$name)){
  dose = prism.treat[prism.treat$name==drug,]$dose
  response = prism[,rownames(prism.treat)[prism.treat$name == drug]]
  
  mean_effective_ovary_new4[drug]=apply(response,1,function(x){mean(x, na.rm=TRUE)})
}
mean_effective_ovary_new4<-mean_effective_ovary_new4[rownames(mean_effective_ovary_new4) %in% achilles_vector_cluster4,]

mean_effective_ovarynew3= data.frame(row.names=rownames(prism))

for (drug in unique(prism.treat$name)){
  dose = prism.treat[prism.treat$name==drug,]$dose
  response = prism[,rownames(prism.treat)[prism.treat$name == drug]]
  
  mean_effective_ovarynew3[drug]=apply(response,1,function(x){mean(x, na.rm=TRUE)})
}
mean_effective_ovarynew3<-mean_effective_ovarynew3[rownames(mean_effective_ovarynew3) %in% achilles_vector_cluster3,]

pvalues_t_test_treat3vs4<-data.frame(mapply(function(x,y)t.test(x,y,na.rm=TRUE,alternative="two.sided", var.equal= FALSE, paired=FALSE)$p.value,mean_effective_ovary_new4,mean_effective_ovarynew3))

pvalues_t_test_treat3vs4<-dplyr::rename(pvalues_t_test_treat3vs4,p_value=mapply.function.x..y..t.test.x..y..na.rm...TRUE..alternative....two.sided...)

pvalues_t_test_treat3vs4$Bonferroni <-
      p.adjust(pvalues_t_test_treat3vs4$p_value,
               method = "bonferroni")



dplyr::arrange(pvalues_t_test_treat3vs4, Bonferroni)

mean_effective_ovary_new1= data.frame(row.names=rownames(prism))

for (drug in unique(prism.treat$name)){
  dose = prism.treat[prism.treat$name==drug,]$dose
  response = prism[,rownames(prism.treat)[prism.treat$name == drug]]
  
  mean_effective_ovary_new1[drug]=apply(response,1,function(x){mean(x, na.rm=TRUE)})
}
mean_effective_ovary_new1<-mean_effective_ovary_new1[rownames(mean_effective_ovary_new1) %in% achilles_vector_cluster1,]

mean_effective_ovarynew3= data.frame(row.names=rownames(prism))

for (drug in unique(prism.treat$name)){
  dose = prism.treat[prism.treat$name==drug,]$dose
  response = prism[,rownames(prism.treat)[prism.treat$name == drug]]
  
  mean_effective_ovarynew3[drug]=apply(response,1,function(x){mean(x, na.rm=TRUE)})
}
mean_effective_ovarynew3<-mean_effective_ovarynew3[rownames(mean_effective_ovarynew3) %in% achilles_vector_cluster3,]

pvalues_t_test_treat3vs1<-data.frame(mapply(function(x,y)t.test(x,y,na.rm=TRUE,alternative="two.sided", var.equal= FALSE, paired=FALSE)$p.value,mean_effective_ovary_new1,mean_effective_ovarynew3))

pvalues_t_test_treat3vs1<-dplyr::rename(pvalues_t_test_treat3vs1,p_value=mapply.function.x..y..t.test.x..y..na.rm...TRUE..alternative....two.sided...)

pvalues_t_test_treat3vs1$Bonferroni <-
      p.adjust(pvalues_t_test_treat3vs1$p_value,
               method = "bonferroni")


pvalues_t_test_treat3vs1<-dplyr::arrange(pvalues_t_test_treat3vs1, Bonferroni)




pvalues_t_test_treat4vs1<-data.frame(mapply(function(x,y)t.test(x,y,na.rm=TRUE,alternative="two.sided", var.equal= FALSE, paired=FALSE)$p.value,mean_effective_ovary_new1,mean_effective_ovary_new4))

pvalues_t_test_treat4vs1<-dplyr::rename(pvalues_t_test_treat4vs1,p_value=mapply.function.x..y..t.test.x..y..na.rm...TRUE..alternative....two.sided...)

pvalues_t_test_treat4vs1$Bonferroni <-
      p.adjust(pvalues_t_test_treat4vs1$p_value,
               method = "bonferroni")


pvalues_t_test_treat4vs1<-dplyr::arrange(pvalues_t_test_treat4vs1, Bonferroni)





#1 vs 3
pvalues_t_test_treat3vs1_reduced<-pvalues_t_test_treat3vs1[rownames(pvalues_t_test_treat3vs1)%in% c("trichostatin-a","semaxanib","alvocidib"),]

##1 vs 4
pvalues_t_test_treat4vs1_reduced<-pvalues_t_test_treat4vs1[rownames(pvalues_t_test_treat4vs1)%in% c("torin-1","AVN-944"),]

# First trial 
df_1 <- pvalues_t_test_treat3vs1_reduced
df_2 <- pvalues_t_test_treat4vs1_reduced
knitr::kable(list(df_1, df_2)) %>%
  kable_styling(full_width=F)

#Second trial
t1 <- kable(pvalues_t_test_treat3vs1_reduced, format = "latex", booktabs = TRUE)
t2 <- kable(pvalues_t_test_treat4vs1_reduced, format = "latex", booktabs = TRUE)

cat(c("\\begin{table}[!htb]
    \\begin{minipage}{.5\\linewidth}
      \\caption{}
      \\centering",
        t1,
    "\\end{minipage}%
    \\begin{minipage}{.5\\linewidth}
      \\centering
        \\caption{}",
        t2,
    "\\end{minipage} 
\\end{table}"
)) 
#knitr::kable(list(table1, table2))
```










---
title: "For Milestone 1.2"
author: "Laura Diekmann"
date: "14 7 2021"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)

```


We reduced the prism.treat data frame to only those cells out of cluster two and four of the pca clustering for non ovary and ovary cell lines. With those two data frames we performed a welch's unpaired two sided t-test. The p-value was higher than the confidence level of 0.05, so the null hypothesis - that there is a equality between the mean value of the drug response of ovary and non ovary cell lines - could not be rejected. Which shows that there seems to be no specific drug with a different drug response for ovary and non ovary cells. 

```{r, 1.2}
##creating a dataframe from the cellines out of cluster 2 and 4
##creating a ector for cluster k2moa 2 and 4
##ovary
achilles_vector_cluster2 = as.vector(na.omit(names(which(km2_moa$cluster == 2))))
achilles_vector_cluster4 = as.vector(na.omit(names(which(km2_moa$cluster == 4))))

##noovary
achilles_noovary_vector_cluster2 = as.vector(na.omit(names(which(km1_moa$cluster == 2))))
achilles_noovary_vector_cluster4 = as.vector(na.omit(names(which(km1_moa$cluster == 4))))



##creating a vector with both 
##ovary
achilles_vector_cluster24<- as.vector(c(achilles_vector_cluster2,achilles_vector_cluster4))
##noovary
achilles_noovary_vector_cluster24<- as.vector(c(achilles_noovary_vector_cluster2, achilles_noovary_vector_cluster4))


##reducing prism.achilles for the t.test to only the cluster 24 celllines
##ovary
ovary_achilles_cluster24 <- prism.achilles[rownames(prism.achilles) %in% achilles_vector_cluster24,]

##nonovary
noovary_achilles_cluster24 <- prism.achilles[rownames(prism.achilles) %in% achilles_noovary_vector_cluster24,]


 
```


```{r, 1.2}
## looking at one drug which is responding to those cluster differently
##mean for non ovary
mean_effective_noovary24= data.frame(row.names=rownames(prism))

for (drug in unique(prism.treat$name)){
  dose = prism.treat[prism.treat$name==drug,]$dose
  response = prism[,rownames(prism.treat)[prism.treat$name == drug]]
  
  mean_effective_noovary24[drug]=apply(response,1,function(x){mean(x, na.rm=TRUE)})
}
mean_effective_noovary24<-mean_effective_noovary24[rownames(mean_effective_noovary24) %in% achilles_noovary_vector_cluster24,]


##mean for ovary
mean_effective_ovary24= data.frame(row.names=rownames(prism))

for (drug in unique(prism.treat$name)){
  dose = prism.treat[prism.treat$name==drug,]$dose
  response = prism[,rownames(prism.treat)[prism.treat$name == drug]]
  
  mean_effective_ovary24[drug]=apply(response,1,function(x){mean(x, na.rm=TRUE)})
}
mean_effective_ovary24<-mean_effective_ovary24[rownames(mean_effective_ovary24) %in% achilles_vector_cluster24,]


##for each column dfovary and dfnonovary t-test
pvalues_t_test_treat24<-data.frame(mapply(function(x,y)t.test(x,y,na.rm=TRUE,alternative="two.sided", var.equal= FALSE, paired=FALSE)$p.value,mean_effective_ovary24,mean_effective_noovary24))


##creatig a dataframe with p-values and drugs
pvalues_t_test_treat24<-rename(pvalues_t_test_treat24,p_value=mapply.function.x..y..t.test.x..y..na.rm...TRUE..alternative....two.sided...)

##adjusting the pvalue by all methods and creating a dataframe with new columns with those methods
pvalues_t_test_treat24$Bonferroni <-
      p.adjust(pvalues_t_test_treat24$p_value,
               method = "bonferroni")

pvalues_t_test_treat24$BH <-
      p.adjust(pvalues_t_test_treat24$p_value,
               method = "BH")

pvalues_t_test_treat24$Holm <-
      p.adjust(pvalues_t_test_treat24$p_value,
               method = "holm")

pvalues_t_test_treat24$Hochberg <-
      p.adjust(pvalues_t_test_treat24$p_value,
               method = "hochberg")

pvalues_t_test_treat24$Hommel <-
      p.adjust(pvalues_t_test_treat24$p_value,
               method = "hommel")

pvalues_t_test_treat24$BY <-
      p.adjust(pvalues_t_test_treat24$p_value,
               method = "BY")



##ranking the drugs
dplyr::arrange(pvalues_t_test_treat24, Bonferroni)

####no significant differences between the drug response between ovary and non ovary celllines!
```

```{r}
##looking into TAK-733
selected_drug_ovary<-select(mean_effective_ovary24, "TAK-733")

selected_drug_noovary<-select(mean_effective_noovary24,"TAK-733")

```
---
title: "Milestone 1.3"
author: "Laura Diekmann"
date: "2 6 2021"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyr)
library(readr)
library(dplyr)
library(plyr)

```

```{r}
## creating a data frame df_treat consisting of dosage and broadID
dosage<- prism.treat$dose
broadID<- prism.treat$broad_id

df_treat <- data.frame(broadID, dosage)
df_treat
```

```{r}
##creating a dataframe df_treat2 consisting the dosage and broadID2

broadID2<- prism.treat[,0]
broadID2
broadID3<-rownames(prism.treat)

df_treat2<- data.frame (broadID2, dosage)
df_treat2


```

```{r}
##We employed a 2-stage screening strategy whereby drugs were first screened in triplicate at a single dose (2.5 μM). 1,448 screening positives were then re-screened in triplicate in an 8-point dose-response ranging from 10 μM to 600 pM

## only the low dosages < 2.5 μM
df_treat_lowdose<-df_treat[dosage<2.5, c("broadID","dosage")]
df_treat_lowdose

#### wie mache ich das mit dem broadID2?

##only the high dosages > 2.5μM
df_treat_highdose<-df_treat[dosage>=2.5, c("broadID","dosage")]
df_treat_highdose









```


```{r}
## copied from Versuch1

## creating a data frame df_cl consisting of DepMap_IDs and lineages
lineage <- prism.cl$lineage
DepMap_ID <- prism.cl$DepMap_ID 

df_cl <- data.frame(DepMap_ID, lineage)

## subsetting data frame to obtain only ovary cell lines with their DepMap_IDs

df_ovary_cl <- subset(df_cl, lineage == "ovary")

df_ovary_cl

dim(df_ovary_cl)

## creating a vector that only contains the ovary cancer DepMap_IDs 

vector_ovary_DepMI <- as.vector(df_ovary_cl$DepMap_ID)


vector_ovary_DepMI

df_ovary_DepMI_prism  <- prism[rownames(prism) %in% vector_ovary_DepMI,]

df_ovary_DepMI_prism


```
```{r, dataframe dose and ovary cell lines}
## creating a dataframe with the ovary DepMap_IDs their ploriferation values and the dose

new_df_ovary_DepMI_prism<- as.data.frame(t(df_ovary_DepMI_prism))
new_df_ovary_DepMI_prism


##creating a dataframe from the ovary cell lines with DepMApID,ploriferation values, broad ID und dose

df_ovary_DepMI_prism_treat <-merge(prism.treat,new_df_ovary_DepMI_prism , by="row.names")
df_ovary_DepMI_prism_treat

##deleting all other columns 
df_ovary_DepMI_prism_treat[,c('screen_id','compound_plate','name','moa','target','disease.area','indication','smiles','phase')]<-list(NULL)

##changing the name of row.names
df_ovary_DepMI_prism_treat <-df_ovary_DepMI_prism_treat%>% rename(drugs=Row.names)
df_ovary_DepMI_prism_treat
df_ovary_DepMI_prism_treat_NAs<-drop_na(df_ovary_DepMI_prism_treat)

##schleife herstellen, filtern (group_by, summarize, pearson, spearman)
```

```{r}


df_ovary_DepMI_prism_treat%>%
  group_by(df_ovary_DepMI_prism_treat,broad_id)%>%
  dplyr::summarize(cor(df_ovary_DepMI_prism_treat$dose,df_ovary_DepMI_prism_treat[,4:33],use="na.or.complete",method='pearson'))

xx <- df_ovary_DepMI_prism_treat%>%
  group_by(broad_id) %>%
  summarize(cor(df_ovary_DepMI_prism_treat$dose,df_ovary_DepMI_prism_treat[,4:33],use="na.or.complete",method='pearson'))
xx



cor(df_ovary_DepMI_prism_treat$dose,df_ovary_DepMI_prism_treat[,4:33],use="na.or.complete",method='pearson')
```





```{r}

dplyr::summarize(gp,cor(df_ovary_DepMI_prism_treat$dose,df_ovary_DepMI_prism_treat[,4:33],use="na.or.complete",method='pearson') )
xx




```
```{r}

```

```{r}

##We now can compute the correlation of the two variables; remember that we can compute the **Pearson correlation** or the **Spearman correlation**

##Pearson correlations
cor(df_ovary_DepMI_dose_NA$dose,df_ovary_DepMI_dose_NA$"ACH-000013",method='pearson')

##Spearman correlation
cor(df_ovary_DepMI_dose_NA$dose,df_ovary_DepMI_dose_NA$"ACH-000013",method='spearman')

####alle 8 Zeilen verschiedene Wirkstoffe

##spearman correlation table with all variations
cor.dose1<-cor(df_ovary_DepMI_dose_NA,method='spearman')


```



---
title: "Milestone 1.3"
author: "Laura Diekmann"
date: "2 6 2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
## creating a data frame df_treat consisting of dosage and broadID
dosage<- prism.treat$dose
broadID<- prism.treat$broad_id

df_treat <- data.frame(broadID, dosage)
df_treat
```

```{r}
##creating a dataframe df_treat2 consisting the dosage and broadID2

broadID2<- prism.treat[,0]
broadID2
broadID3<-rownames(prism.treat)

df_treat2<- data.frame (broadID2, dosage)
df_treat2


```

```{r}
##We employed a 2-stage screening strategy whereby drugs were first screened in triplicate at a single dose (2.5 μM). 1,448 screening positives were then re-screened in triplicate in an 8-point dose-response ranging from 10 μM to 600 pM

## only the low dosages < 2.5 μM
df_treat_lowdose<-df_treat[dosage<2.5, c("broadID","dosage")]
df_treat_lowdose

#### wie mache ich das mit dem broadID2?

##only the high dosages > 2.5μM
df_treat_highdose<-df_treat[dosage>2.5, c("broadID","dosage")]
df_treat_highdose









```


```{r}
## copied from Versuch1

## creating a data frame df_cl consisting of DepMap_IDs and lineages
lineage <- prism.cl$lineage
DepMap_ID <- prism.cl$DepMap_ID 

df_cl <- data.frame(DepMap_ID, lineage)

## subsetting data frame to obtain only ovary cell lines with their DepMap_IDs

df_ovary_cl <- subset(df_cl, lineage == "ovary")

df_ovary_cl

dim(df_ovary_cl)

## creating a vector with ovary cancer DepMap_IDs 

vector_ovary_DepMI <- as.vector(df_ovary_cl$DepMap_ID)
vector_ovary_DepMI <- as.vector(df_ovary_cl$DepMap_ID)
vector_ovary_DepMI

## creating a subset dataframe of prism with only the ovary DepMap_IDs and their proliferation values   
df_ovary_DepMI_prism  <- subset(prism, DepMap_ID %in% vector_ovary_DepMI)
df_ovary_DepMI_prism


```
```{r, dataframe dose and ovary cell lines}
## creating a dataframe with the ovary DepMap_IDs their ploriferation values and the dose

new_df_ovary_DepMI_prism<- as.data.frame(t(df_ovary_DepMI_prism))
new_df_ovary_DepMI_prism

##oben den Namen von den Spalten ändern

colnames(new_df_treat)<-broadID3
new_df_treat


##creating a dataframe from the ovary cell lines with DepMApID,ploriferation values, broad ID und dose
new_df_ovary_DepMI_prism$dose<-df_treat$dosage
df_ovary_DepMI_dose<-new_df_ovary_DepMI_prism


##command to switch rows (copied out of the internet https://www.it-swarm.com.de/de/r/verschieben-von-spalten-innerhalb-eines-data.frame-ohne-erneutes-eingeben/969073031/)
moveme <- function (invec, movecommand) {
  movecommand <- lapply(strsplit(strsplit(movecommand, ";")[[1]], 
                                 ",|\\s+"), function(x) x[x != ""])
  movelist <- lapply(movecommand, function(x) {
    Where <- x[which(x %in% c("before", "after", "first", 
                              "last")):length(x)]
    ToMove <- setdiff(x, Where)
    list(ToMove, Where)
  })
  myVec <- invec
  for (i in seq_along(movelist)) {
    temp <- setdiff(myVec, movelist[[i]][[1]])
    A <- movelist[[i]][[2]][1]
    if (A %in% c("before", "after")) {
      ba <- movelist[[i]][[2]][2]
      if (A == "before") {
        after <- match(ba, temp) - 1
      }
      else if (A == "after") {
        after <- match(ba, temp)
      }
    }
    else if (A == "first") {
      after <- 0
    }
    else if (A == "last") {
      after <- length(myVec)
    }
    myVec <- append(temp, values = movelist[[i]][[1]], after = after)
  }
  myVec
}
##shifting dose to the first row
df_ovary_DepMI_dose<-df_ovary_DepMI_dose[moveme(names(df_ovary_DepMI_dose), "dose first")]
df_ovary_DepMI_dose


```

```{r}
## removing all missing values
rmv.rows = apply(df_ovary_DepMI_dose,1,function(x){sum(is.na(x))})
df_ovary_DepMI_dose_NA = df_ovary_DepMI_dose[- which(rmv.rows > 0),]
df_ovary_DepMI_dose_NA

## plotting the decency of single ovary cell proliferation to different doses
plot(df_ovary_DepMI_dose_NA$dose,
     df_ovary_DepMI_dose_NA$"ACH-000091",
     xlab='dosage',
     ylab='ovary cell proliferation'
     )
####würde ich gerne mit sapply auf alle Zellen anwenden Wie?

```
```{r}
##histogram of a single ovary cell proliferation
summary(df_ovary_DepMI_dose_NA)
histMeanMedCol <- function(x, mean.col, median.col){
  hist(x)
  abline(v = c(summary(x)[4],summary(x)[3]), col = c(mean.col,median.col))
}
  
histMeanMedCol(df_ovary_DepMI_dose_NA$`ACH-000091`, "pink","green")
####würde ich gerne mit sapply auf alle Zellen anwenden Wie?
```

```{r}

##We now can compute the correlation of the two variables; remember that we can compute the **Pearson correlation** or the **Spearman correlation**

##Pearson correlations
cor(df_ovary_DepMI_dose_NA$dose,df_ovary_DepMI_dose_NA$"ACH-000091",method='pearson')

##Spearman correlation
cor(df_ovary_DepMI_dose_NA$dose,df_ovary_DepMI_dose_NA$"ACH-000091",method='spearman')

##spearman correlation table with all variations
cor.dose1<-cor(df_ovary_DepMI_dose_NA,method='spearman')

##trying to do it with all ovary cells to the column dose
sapply(cor(df_ovary_DepMI_dose_NA$dose,df_ovary_DepMI_dose_NA[2,],method = "spearman"))
```
```{r}
library(pheatmap)
pheatmap(cor.dose1)
```


